<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>History Foundation - üòáPULY‚ù§Ô∏èSTARüòá</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            margin: 0;
            background: #000;
            color: #00ff00;
            overflow-x: hidden;
            position: relative;
        }
        #login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background: url('https://i.gifer.com/3iP8.gif') no-repeat center/cover;
            position: relative;
            z-index: 1;
        }
        #login-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: -1;
        }
        #login-box {
            background: #1a1a1a;
            padding: 30px;
            border: 2px solid #00ff00;
            border-radius: 10px;
            box-shadow: 0 0 30px rgba(0, 255, 0, 0.7);
            text-align: center;
            width: 300px;
            animation: glitch 0.5s infinite;
        }
        @keyframes glitch {
            0% { transform: translate(0); }
            20% { transform: translate(-5px, 5px); }
            40% { transform: translate(5px, -5px); }
            60% { transform: translate(-5px, -5px); }
            80% { transform: translate(5px, 5px); }
            100% { transform: translate(0); }
        }
        #login-box h2 {
            color: #00ff00;
            text-transform: uppercase;
            margin-bottom: 20px;
            font-size: 1.5em;
            text-shadow: 0 0 10px #00ff00;
        }
        #login-box input {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            background: #000;
            border: 1px solid #00ff00;
            color: #00ff00;
            font-family: 'Courier New', monospace;
            border-radius: 5px;
        }
        #login-box button {
            padding: 10px 20px;
            background: #00ff00;
            color: #000;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            transition: background 0.3s;
        }
        #login-box button:hover {
            background: #00cc00;
        }
        #login-error {
            color: #ff0000;
            font-size: 0.9em;
            margin-top: 10px;
            text-shadow: 0 0 5px #ff0000;
        }
        #main-content {
            display: none;
            margin: 20px;
            background: linear-gradient(to bottom, #1a1a1a, #2a2a2a);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.5);
        }
        .header h1 {
            color: #00ff00;
            cursor: pointer;
            font-size: 2.5em;
            text-shadow: 0 0 15px #00ff00;
            animation: shake 0.1s infinite;
        }
        @keyframes shake {
            0% { transform: translate(0, 0); }
            25% { transform: translate(-3px, 3px); }
            50% { transform: translate(3px, -3px); }
            75% { transform: translate(-3px, -3px); }
            100% { transform: translate(3px, 3px); }
        }
        .header h1:hover {
            text-decoration: underline;
        }
        .header h2 {
            color: #00cc00;
            font-size: 1.8em;
            text-shadow: 0 0 5px #00cc00;
        }
        .header img {
            max-width: 800px;
            border: 2px solid #00ff00;
            border-radius: 10px;
            box-shadow: 0 0 10px #00ff00;
        }
        .tabs {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
        }
        .tab {
            padding: 10px 20px;
            background: #00ff00;
            color: #000;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s;
            animation: shake 0.1s infinite;
        }
        .tab.active {
            background: #00cc00;
        }
        .tab:hover {
            background: #33ff33;
        }
        .section {
            display: none;
        }
        .section.active {
            display: block;
        }
        .video-list .item, .notes-list .item {
            margin: 10px auto;
            padding: 10px;
            background: #2a2a2a;
            border: 1px solid #00ff00;
            border-radius: 5px;
            max-width: 600px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 0 10px rgba(0, 255, 0, 0.3);
        }
        .video-list .item img, .notes-list .item img {
            width: 150px;
            height: 90px;
            border-radius: 5px;
            border: 1px solid #00ff00;
        }
        .video-list .item span, .notes-list .item span {
            font-size: 1.2em;
            color: #00ff00;
        }
        .video-list .item .credit, .notes-list .item .credit {
            font-size: 0.9em;
            color: #33ff33;
        }
        .notes-list .item .file-info {
            font-size: 0.9em;
            color: #00cc00;
        }
        .modal-player {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        .modal-player.active {
            display: flex;
        }
        .modal-player .player-content {
            background: #1a1a1a;
            padding: 15px;
            border: 2px solid #00ff00;
            border-radius: 8px;
            max-width: 700px;
            width: 90%;
            box-shadow: 0 0 20px #00ff00;
        }
        .modal-player h3 {
            color: #00ff00;
            font-size: 1.5em;
            text-shadow: 0 0 5px #00ff00;
        }
        .modal-player .credit {
            color: #33ff33;
        }
        .modal-player .data-usage {
            color: #00cc00;
            font-size: 0.9em;
        }
        video {
            width: 100%;
            max-width: 600px;
            border: 2px solid #00ff00;
            border-radius: 5px;
        }
        .button-container {
            margin-top: 10px;
            display: flex;
            gap: 10px;
            justify-content: center;
        }
        .download-btn, .play-btn, .copy-btn, .default-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            background: #00ff00;
            color: #000;
        }
        .download-btn:hover, .play-btn:hover, .copy-btn:hover, .default-btn:hover {
            background: #00cc00;
        }
        .quality-selector {
            display: flex;
            gap: 10px;
            padding: 10px;
            justify-content: center;
            overflow-x: auto;
        }
        .quality-option {
            padding: 8px 16px;
            background: #00ff00;
            color: #000;
            border-radius: 5px;
            cursor: pointer;
        }
        .quality-option:hover {
            background: #33ff33;
        }
        .quality-option.active {
            background: #00cc00;
        }
        .loader {
            position: absolute;
            bottom: 5px;
            height: 3px;
            background: #00ff00;
            transition: all 0.3s ease;
        }
        .youtube-logo {
            position: fixed;
            bottom: 15px;
            left: 15px;
            z-index: 100;
            animation: fadeInOut 8s infinite;
        }
        .youtube-logo img {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            border: 2px solid #00ff00;
            box-shadow: 0 0 10px #00ff00;
        }
        .youtube-logo img:hover {
            transform: scale(1.1);
        }
        @keyframes fadeInOut {
            0%, 100% { opacity: 0; }
            20%, 80% { opacity: 1; }
        }
        #petals {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 99;
        }
        .petal {
            position: absolute;
            width: 20px;
            height: 20px;
            background: url('https://www.pngall.com/wp-content/uploads/2016/04/Rose-Petal-PNG-Clipart.png') no-repeat center;
            background-size: cover;
            opacity: 0.7;
            animation: fall 5s linear;
        }
        @keyframes fall {
            0% { transform: translateY(-100px) rotate(0deg); opacity: 0.7; }
            100% { transform: translateY(100vh) rotate(360deg); opacity: 0; }
        }
        .matrix-rain {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            pointer-events: none;
        }
        .code-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
        }
        .code-snippet {
            position: absolute;
            color: #00ff00;
            font-size: 0.8em;
            opacity: 0;
            animation: flashCode 5s infinite;
        }
        @keyframes flashCode {
            0% { opacity: 0; }
            10% { opacity: 0.7; }
            20% { opacity: 0; }
            100% { opacity: 0; }
        }
        .floating-username {
            position: fixed;
            top: 10px;
            left: 10px;
            color: #00ff00;
            font-size: 1.2em;
            text-shadow: 0 0 10px #00ff00;
            animation: float 4s infinite ease-in-out;
            z-index: 100;
        }
        @keyframes float {
            0% { transform: translate(0, 0); }
            50% { transform: translate(20px, 20px); }
            100% { transform: translate(0, 0); }
        }
    </style>
</head>
<body>
    <canvas id="matrix" class="matrix-rain"></canvas>
    <div class="code-overlay" id="code-overlay"></div>
    <div id="login-container">
        <div id="login-box">
            <h2>INFILTRATE PULY STAR SYSTEM</h2>
            <input type="text" id="username" placeholder="Codename" autocomplete="off">
            <input type="password" id="password" placeholder="Access Key" autocomplete="off">
            <button onclick="login()">BREACH SYSTEM</button>
            <div id="login-error"></div>
        </div>
    </div>
    <div id="main-content">
        <div id="petals"></div>
        <div class="floating-username" id="floating-username">Hacker: <span id="user-display"></span> ‚ò†Ô∏è</div>
        <div class="header">
            <h1 onclick="window.open('https://youtube.com/@starpranks09', '_blank')">‚ò†Ô∏èPULY‚ù§STAR‚ò†Ô∏è</h1>
            <h2>KHAN SIR HISTORY CLASSES</h2>
            <img src="https://i.ytimg.com/vi_webp/o1kEOHmAZ7Q/sddefault.webp" alt="Khan Sir History Classes">
        </div>
        <div class="tabs">
            <div class="tab active" onclick="showSection('videos')">Videos</div>
            <div class="tab" onclick="showSection('notes')">Notes</div>
        </div>
        <div id="videos" class="section active">
            <div class="video-list"></div>
        </div>
        <div id="notes" class="section">
            <div class="notes-list"></div>
        </div>
        <div class="modal-player" id="modal-player">
            <div class="player-content">
                <h3 id="modal-player-title">History Lecture</h3>
                <div class="credit">By PULY STAR</div>
                <div class="data-usage" id="modal-player-data-usage"></div>
                <video id="modal-video" controls poster="https://i.ytimg.com/vi_webp/o1kEOHmAZ7Q/sddefault.webp"></video>
                <div class="quality-selector" id="quality-selector">
                    <div class="quality-option" data-quality="720">720</div>
                    <div class="quality-option" data-quality="480">480</div>
                    <div class="quality-option" data-quality="360">360</div>
                    <div class="quality-option" data-quality="240">240</div>
                    <div class="quality-option" data-quality="144">144</div>
                    <div class="loader" id="quality-loader"></div>
                </div>
                <div class="button-container">
                    <a class="default-btn" id="default-btn" href="#" onclick="playDefault()">Default</a>
                    <a class="download-btn" href="#" id="modal-download-btn">DOWNLOAD</a>
                    <button class="play-btn" onclick="playNow()">Play</button>
                    <button class="copy-btn" onclick="copyLink()">Copy Link</button>
                </div>
            </div>
        </div>
        <a class="youtube-logo" href="https://youtube.com/@starpranks09" target="_blank">
            <img src="https://yt3.googleusercontent.com/BCD6wsUKh9xKG8XPxBO6K7l0W9xpQmXQ7TeI_zPr2n4-2J2wtm03-C8WqNM6l73r8zeBiu4Dtw=s160-c-k-c0x00ffffff-no-rj" alt="PULY STAR YouTube">
        </a>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <script>
        // Matrix rain effect
        const canvas = document.getElementById('matrix');
        const ctx = canvas.getContext('2d');
        canvas.height = window.innerHeight;
        canvas.width = window.innerWidth;
        const chars = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ!@#$%^&*()';
        const fontSize = 14;
        const columns = canvas.width / fontSize;
        const drops = [];
        for (let x = 0; x < columns; x++) drops[x] = 1;
        function drawMatrix() {
            ctx.fillStyle = 'rgba(0, 0, 0, 0.05)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = '#00ff00';
            ctx.font = fontSize + 'px monospace';
            for (let i = 0; i < drops.length; i++) {
                const text = chars.charAt(Math.floor(Math.random() * chars.length));
                ctx.fillText(text, i * fontSize, drops[i] * fontSize);
                if (drops[i] * fontSize > canvas.height && Math.random() > 0.975) drops[i] = 0;
                drops[i]++;
            }
        }
        setInterval(drawMatrix, 33);

        // Code overlay effect
        const codeSnippets = [
            'sudo rm -rf /system',
            'nmap -sS 192.168.1.0/24',
            'curl -X POST http://hack.me',
            'while(true) { fork(); }',
            'openssl enc -aes-256-cbc',
            'whoami > /dev/null'
        ];
        function createCodeSnippets() {
            const overlay = document.getElementById('code-overlay');
            for (let i = 0; i < 5; i++) {
                const snippet = document.createElement('div');
                snippet.className = 'code-snippet';
                snippet.textContent = codeSnippets[Math.floor(Math.random() * codeSnippets.length)];
                snippet.style.left = Math.random() * 100 + 'vw';
                snippet.style.top = Math.random() * 100 + 'vh';
                snippet.style.animationDelay = Math.random() * 3 + 's';
                overlay.appendChild(snippet);
                setTimeout(() => snippet.remove(), 5000);
            }
        }
        setInterval(createCodeSnippets, 2000);

        // Login system
        let currentUsername = '';
        function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const error = document.getElementById('login-error');
            if (password === 'PULY' && username.trim()) {
                currentUsername = username;
                document.getElementById('user-display').textContent = username;
                document.getElementById('login-container').style.display = 'none';
                document.getElementById('main-content').style.display = 'block';
            } else {
                error.textContent = 'SYSTEM LOCKOUT: Invalid credentials';
            }
        }

        // Existing JavaScript with added quality options
        const videoList = document.querySelector('.video-list');
        const notesList = document.querySelector('.notes-list');
        const modalPlayer = document.getElementById('modal-player');
        const modalVideo = document.getElementById('modal-video');
        const modalPlayerTitle = document.getElementById('modal-player-title');
        const modalPlayerDataUsage = document.getElementById('modal-player-data-usage');
        const qualitySelector = document.getElementById('quality-selector');
        const qualityLoader = document.getElementById('quality-loader');
        const modalDownloadBtn = document.getElementById('modal-download-btn');
        const defaultBtn = document.getElementById('default-btn');
        const petalsContainer = document.getElementById('petals');

        let currentLecture = null;
        let selectedQuality = null;
        let isDragging = false;
        let startX = 0;

        const pdfLinks = {
            1: { url: 'https://kgs-v2.akamaized.net/kgs-test/Notes/history-recorded/note-1/history-test-01.pdf', title: 'History Test 01', date: '' },
            2: { url: 'https://kgs-v2.akamaized.net/kgs-test/Notes/history-recorded/note-2/ancient-history01.pdf', title: 'Ancient History 01', date: '' },
            3: { url: 'https://kgs-v2.akamaized.net/kgs-test/Notes/history-recorded/note-3/baudh-and-jain-dharm.pdf', title: 'Baudh and Jain dharm', date: '' },
            4: { url: 'https://kgs-v2.akamaized.net/kgs-test/Notes/history-recorded/note-4/indian-religion-mahajanpad-morya-vansh.pdf', title: 'Indian Religion+Mahajanpad+Morya Vansh', date: '' },
            5: { url: 'https://kgs-v2.akamaized.net/kgs-test/Notes/history-recorded/note-5/ispk.pdf', title: '‡§Æ‡•ã‡§∞‡•ç‡§Ø‡•ã‡§§‡•ç‡§§‡§∞ ‡§ï‡§æ‡§≤ (ISPK)', date: '' },
            6: { url: 'https://kgs-v2.akamaized.net/kgs-test/Notes/history-recorded/note-6/mauryotar-kal.pdf', title: 'Mauryotar kal', date: '' },
            7: { url: 'https://kgs-v2.akamaized.net/kgs-test/Notes/history-recorded/note-7/sangam-kal.pdf', title: 'Sangam Kal', date: '' },
            8: { url: 'https://kgs-v2.akamaized.net/kgs-test/Notes/history-recorded/note-8/dakshin-bharat-khan-sir-history.pdf', title: 'dakshin bharat khan sir history', date: '' },
            9: { url: 'https://kgs-v2.akamaized.net/kgs-test/Notes/history-recorded/note-9/medieval-history.pdf', title: 'Medieval History', date: '' },
            10: { url: 'https://kgs-v2.akamaized.net/kgs-test/Notes/history-recorded/note-10/vijay-nagar-bkhakti-kaal-mughal.pdf', title: 'Vijay Nagar+Bkhakti kaal+Mughal', date: '' },
            11: { url: 'https://kgs-v2.akamaized.net/kgs-test/Notes/history-recorded/note-11/medievle-history-test.pdf', title: 'Medievle History Test', date: '' },
            12: { url: 'https://kgs-v2.akamaized.net/kgs-test/Notes/history-recorded/note-12/maratha-samrajya.pdf', title: 'Maratha Samrajya', date: '' },
            13: { url: 'https://kgs-v2.akamaized.net/kgs-test/Notes/history-recorded/note-13/major-small-states.pdf', title: '‡§™‡•ç‡§∞‡§Æ‡•Å‡§ñ ‡§õ‡•ã‡§ü‡•á ‡§∞‡§æ‡§ú‡•ç‡§Ø', date: '' },
            14: { url: 'https://kgs-v2.akamaized.net/kgs-test/Notes/history-recorded/note-14/revolution-of-1857.pdf', title: 'Revolution of 1857', date: '' },
            15: { url: 'https://kgs-v2.akamaized.net/kgs-test/Notes/history-recorded/note-15/1857-ki-kranti-2.pdf', title: '1857 ki kranti (2)', date: '' },
            16: { url: 'https://kgs-v2.akamaized.net/kgs-test/Notes/history-recorded/note-16/bhartiya-rashtriya-congress.pdf', title: 'bhartiya rashtriya congress', date: '' },
            17: { url: 'https://kgs-v2.akamaized.net/kgs-test/Notes/history-recorded/note-17/social-reform-organisation.pdf', title: 'Social Reform Organisation', date: '' },
            18: { url: 'https://kgs-v2.akamaized.net/kgs-test/Notes/history-recorded/note-18/gandhi-era.pdf', title: '‡§ó‡§æ‡§Ç‡§ß‡•Ä ‡§Ø‡•Å‡§ó', date: '' },
            19: { url: 'https://kgs-v1.akamaized.net/kgs-test/Notes/history-recorded/note-19/crisp-prastav.pdf', title: 'Crisp Prastav', date: '' },
            20: { url: 'https://kgs-v2.akamaized.net/kgs-test/Notes/history-recorded/note-20/delhi-darbar.pdf', title: 'Delhi Darbar', date: '' },
            21: { url: 'https://kgs-v2.akamaized.net/kgs/do/pdfs/96d0b883-fade-44c7-93ce-0db05cd5c3fa.pdf', title: 'History Complete Notes', date: '04 Jul 2024' },
            22: { url: 'https://kgs.nyc3.digitaloceanspaces.com/pdfs/a453294c-4ccf-4922-9f25-f2c906ed9fb7.pdf', title: 'Indian Congress Session', date: '19 Dec 2024' },
            23: { url: 'https://kgs.nyc3.digitaloceanspaces.com/pdfs/12833f76-1af1-4c4d-b6e3-de213573139c.pdf', title: 'Modern History full Notes', date: '06 Jan 2025' }
        };

        const pdfSizes = {};
        const videoDataUsage = {
            '720': { perMin: 1.125, total: 1.125 * 40, label: 'Ultra' }, // ~2.5 Mbps
            '480': { perMin: 0.675, total: 0.675 * 40, label: 'High' }, // ~1.5 Mbps
            '360': { perMin: 0.3375, total: 0.3375 * 40, label: 'Medium' }, // ~0.75 Mbps
            '240': { perMin: 0.18, total: 0.18 * 40, label: 'Low' }, // ~0.4 Mbps
            '144': { perMin: 0.09, total: 0.09 * 40, label: 'Minimal' } // ~0.2 Mbps
        };
        const videoDuration = 40;

        async function fetchPdfSize(url, lecture) {
            try {
                const response = await fetch(url, { method: 'HEAD' });
                if (response.ok) {
                    const size = response.headers.get('content-length');
                    pdfSizes[lecture] = size ? (size / (1024 * 1024)).toFixed(2) : 5;
                } else {
                    pdfSizes[lecture] = 5;
                }
            } catch (e) {
                pdfSizes[lecture] = 5;
            }
            const noteItem = document.querySelector(`.notes-list .item[data-lecture="${lecture}"]`);
            if (noteItem) {
                const date = pdfLinks[lecture].date ? `, ${pdfLinks[lecture].date}` : '';
                noteItem.querySelector('.file-info').textContent = `Size: ~${pdfSizes[lecture]} MB${date}`;
            }
        }

        function createPetals() {
            for (let i = 0; i < 10; i++) {
                const petal = document.createElement('div');
                petal.className = 'petal';
                petal.style.left = Math.random() * 100 + 'vw';
                petal.style.animationDelay = Math.random() * 2 + 's';
                petalsContainer.appendChild(petal);
            }
            const petals = document.querySelectorAll('.petal');
            petals.forEach(petal => petal.style.display = 'block');
            setTimeout(() => petals.forEach(petal => petal.remove()), 3000);
        }
        setInterval(createPetals, 10000);

        for (let i = 1; i <= 126; i++) {
            const videoItem = document.createElement('div');
            videoItem.className = 'item';
            videoItem.dataset.lecture = i;
            videoItem.innerHTML = `
                <img src="https://i.ytimg.com/vi_webp/o1kEOHmAZ7Q/sddefault.webp" alt="Lecture-${i}">
                <div class="content">
                    <span>History Lecture-${i}</span>
                    <div class="credit">By PULY STAR</div>
                </div>
            `;
            videoItem.onclick = function() {
                currentLecture = i;
                modalPlayerTitle.textContent = `History Lecture-${i}`;
                modalPlayerDataUsage.textContent = `Duration: ~${videoDuration} min, Data: ~${videoDataUsage['720'].total.toFixed(2)} MB (Ultra 720)`;
                selectedQuality = null;
                loadVideo(getDefaultM3u8Url(i));
                modalPlayer.classList.add('active');
                moveLoaderToQuality('720');
            };
            videoList.appendChild(videoItem);

            if (pdfLinks[i]) {
                const noteItem = document.createElement('div');
                noteItem.className = 'item';
                noteItem.dataset.lecture = i;
                const date = pdfLinks[i].date ? `, ${pdfLinks[i].date}` : '';
                noteItem.innerHTML = `
                    <img src="https://i.ytimg.com/vi_webp/o1kEOHmAZ7Q/sddefault.webp" alt="${pdfLinks[i].title}">
                    <div class="content">
                        <span>${pdfLinks[i].title}</span>
                        <div class="credit">By PULY STAR</div>
                        <div class="file-info">Size: ~${pdfSizes[i] || 5} MB${date}</div>
                    </div>
                `;
                noteItem.onclick = function() {
                    window.open(pdfLinks[i].url, '_blank');
                };
                notesList.appendChild(noteItem);
                fetchPdfSize(pdfLinks[i].url, i);
            }
        }

        qualitySelector.addEventListener('mousedown', startDrag);
        qualitySelector.addEventListener('touchstart', startDrag);
        document.addEventListener('mousemove', drag);
        document.addEventListener('touchmove', drag);
        document.addEventListener('mouseup', endDrag);
        document.addEventListener('touchend', endDrag);

        function startDrag(e) {
            isDragging = true;
            startX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;
        }

        function drag(e) {
            if (!isDragging) return;
            e.preventDefault();
            const x = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;
            const delta = x - startX;
            qualitySelector.scrollLeft -= delta;
            startX = x;
            updateLoaderPosition();
        }

        function endDrag() {
            isDragging = false;
        }

        document.querySelectorAll('.quality-option').forEach(option => {
            option.addEventListener('click', function() {
                selectedQuality = this.dataset.quality;
                document.querySelectorAll('.quality-option').forEach(opt => opt.classList.remove('active'));
                this.classList.add('active');
                moveLoaderToQuality(selectedQuality);
                if (currentLecture) {
                    loadVideo(getM3u8Url(currentLecture, selectedQuality));
                    modalPlayerDataUsage.textContent = `Duration: ~${videoDuration} min, Data: ~${videoDataUsage[selectedQuality].total.toFixed(2)} MB (${videoDataUsage[selectedQuality].label} ${selectedQuality})`;
                }
            });
        });

        function updateLoaderPosition() {
            const activeOption = document.querySelector('.quality-option.active') || document.querySelector('.quality-option[data-quality="720"]');
            moveLoaderToQuality(activeOption.dataset.quality);
        }

        function moveLoaderToQuality(quality) {
            const option = document.querySelector(`.quality-option[data-quality="${quality}"]`);
            if (option) {
                const rect = option.getBoundingClientRect();
                const parentRect = qualitySelector.getBoundingClientRect();
                qualityLoader.style.width = `${rect.width}px`;
                qualityLoader.style.left = `${rect.left - parentRect.left + qualitySelector.scrollLeft}px`;
            }
        }

        function playDefault() {
            if (currentLecture) {
                selectedQuality = null;
                loadVideo(getDefaultM3u8Url(currentLecture));
                modalPlayerDataUsage.textContent = `Duration: ~${videoDuration} min, Data: ~${videoDataUsage['720'].total.toFixed(2)} MB (Ultra 720)`;
                document.querySelectorAll('.quality-option').forEach(opt => opt.classList.remove('active'));
                document.querySelector('.quality-option[data-quality="720"]').classList.add('active');
                moveLoaderToQuality('720');
            }
        }

        modalDownloadBtn.onclick = function() {
            if (!currentLecture) return false;
            const quality = selectedQuality || '720';
            const m3u8Url = selectedQuality ? getM3u8Url(currentLecture, quality) : getDefaultM3u8Url(currentLecture);
            try {
                window.location.href = `intent://${m3u8Url}#Intent;package=idm.internet.download.manager;scheme=https;end`;
            } catch (e) {
                navigator.clipboard.writeText(m3u8Url).then(() => {
                    alert(`"History Lecture-${currentLecture}" ‡§ï‡§æ ${quality} ‡§≤‡§ø‡§Ç‡§ï ‡§ï‡•â‡§™‡•Ä ‡§π‡•ã ‡§ó‡§Ø‡§æ!\n‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§° ‡§ó‡§æ‡§á‡§°:\n1. 1DM ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç: https://play.google.com/store/apps/details?id=idm.internet.download.manager\n2. 1DM ‡§Æ‡•á‡§Ç ‡§≤‡§ø‡§Ç‡§ï ‡§™‡•á‡§∏‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç‡•§\n3. VLC ‡§Æ‡•á‡§Ç ‡§™‡•á‡§∏‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç ‚Üí "Convert/Save" ‚Üí MP4 ‡§Æ‡•á‡§Ç ‡§∏‡•á‡§µ ‡§ï‡§∞‡•á‡§Ç‡•§\n4. ffmpeg: ffmpeg -i "${m3u8Url}" -c copy "History Lecture-${currentLecture}.mp4"\n‡§ï‡•ç‡§µ‡§æ‡§≤‡§ø‡§ü‡•Ä: ${quality} (~${videoDataUsage[quality].total.toFixed(2)} MB)`);
                });
            }
            return false;
        };

        function copyLink() {
            if (!currentLecture) {
                alert('‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡§π‡§≤‡•á ‡§è‡§ï ‡§µ‡•Ä‡§°‡§ø‡§Ø‡•ã ‡§ö‡•Å‡§®‡•á‡§Ç!');
                return;
            }
            const quality = selectedQuality || '720';
            const m3u8Url = selectedQuality ? getM3u8Url(currentLecture, quality) : getDefaultM3u8Url(currentLecture);
            navigator.clipboard.writeText(m3u8Url).then(() => {
                alert(`"History Lecture-${currentLecture}" (${quality}) ‡§≤‡§ø‡§Ç‡§ï ‡§ï‡•â‡§™‡•Ä ‡§π‡•ã ‡§ó‡§Ø‡§æ! (~${videoDataUsage[quality].total.toFixed(2)} MB)`);
            }).catch(() => {
                alert('‡§≤‡§ø‡§Ç‡§ï ‡§ï‡•â‡§™‡•Ä ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø! ‡§ï‡•É‡§™‡§Ø‡§æ ‡§¨‡•ç‡§∞‡§æ‡§â‡§ú‡§º‡§∞ ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø‡§Ø‡§æ‡§Å ‡§ú‡§æ‡§Ç‡§ö‡•á‡§Ç‡•§');
            });
        }

        function playNow() {
            if (currentLecture) {
                const quality = selectedQuality || '720';
                const m3u8Url = selectedQuality ? getM3u8Url(currentLecture, quality) : getDefaultM3u8Url(currentLecture);
                loadVideo(m3u8Url);
                modalPlayerDataUsage.textContent = `Duration: ~${videoDuration} min, Data: ~${videoDataUsage[quality].total.toFixed(2)} MB (${videoDataUsage[quality].label} ${quality})`;
                modalVideo.play().catch(e => console.error(`Video playback failed: ${e.message}`));
            }
        }

        function showSection(section) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelector(`#${section}`).classList.add('active');
            document.querySelector(`.tab[onclick="showSection('${section}')"]`).classList.add('active');
            modalPlayer.classList.remove('active');
            currentLecture = null;
            selectedQuality = null;
            modalPlayerDataUsage.textContent = '';
        }

        function getDefaultM3u8Url(lectureNumber) {
            return `https://kgs-v2.akamaized.net/kgs-test/history-foundation/l${lectureNumber}/l${lectureNumber}.m3u8`;
        }

        function getM3u8Url(lectureNumber, quality) {
            return `https://kgs-v2.akamaized.net/kgs-test/history-foundation/l${lectureNumber}/${quality}.m3u8`;
        }

        function loadVideo(m3u8Url) {
            if (Hls.isSupported()) {
                const hls = new Hls({
                    enableWorker: true,
                    lowLatencyMode: true,
                    backBufferLength: 90
                });
                hls.loadSource(m3u8Url);
                hls.attachMedia(modalVideo);
                hls.on(Hls.Events.MANIFEST_PARSED, () => console.log('HLS manifest loaded'));
                hls.on(Hls.Events.ERROR, (event, data) => {
                    console.error(`HLS error: ${data.type} - ${data.details}`);
                    if (data.fatal) {
                        switch (data.type) {
                            case Hls.ErrorTypes.NETWORK_ERROR:
                                hls.startLoad();
                                break;
                            case Hls.ErrorTypes.MEDIA_ERROR:
                                hls.recoverMediaError();
                                break;
                            default:
                                alert('CRITICAL SYSTEM FAILURE: Video stream corrupted');
                                break;
                        }
                    }
                });
            } else if (modalVideo.canPlayType('application/vnd.apple.mpegurl')) {
                modalVideo.src = m3u8Url;
                modalVideo.addEventListener('error', () => {
                    console.error('Native HLS error');
                    alert('CRITICAL SYSTEM FAILURE: Video stream corrupted');
                });
            } else {
                console.error('HLS not supported');
                alert('CRITICAL SYSTEM FAILURE: Video stream corrupted');
            }
        }

        modalVideo.addEventListener('play', function() {
            if (currentLecture) {
                const m3u8Url = selectedQuality ? getM3u8Url(currentLecture, selectedQuality) : getDefaultM3u8Url(currentLecture);
                loadVideo(m3u8Url);
            }
        }, { once: true });

        modalPlayer.addEventListener('click', function(e) {
            if (e.target === modalPlayer) {
                modalPlayer.classList.remove('active');
                modalVideo.pause();
            }
        });
    </script>
</body>
</html>